# LCOV Code Coverage Extension for Lucee

This extension provides LCOV code coverage reporting capabilities for Lucee CFML applications.

## Features

- Parse execution log files (.exl) generated by Lucee's Execution Logging https://docs.lucee.org/recipes/execution-log.html
- Generate LCOV format reports compatible with standard coverage tools
- Create HTML reports with detailed line-by-line coverage visualization
- Support for multiple time unit displays (seconds, milliseconds, microseconds, nanoseconds)
- AST-based source code analysis for accurate line counting (TBD)
- Coverage statistics and reporting utilities
- Can handle processing large logs from a single test suite execution run

## HTML Reports

<img width="1242" height="1210" alt="image" src="https://github.com/user-attachments/assets/e23f726a-d0da-4ec0-bb39-d815a362babc" />


## VS Code 

The LCOV files produced by this extension can be visualised in VSCODE
https://marketplace.visualstudio.com/items?itemName=ryanluker.vscode-coverage-gutters

<img width="636" height="717" alt="image" src="https://github.com/user-attachments/assets/e1848c17-47cc-4ef6-b82c-974734e7fbad" />

## Components

### Core Components

- **codeCoverageReporter** - Main reporter component that orchestrates the coverage reporting process
- **codeCoverageExlParser** - Parses Lucee .exl execution log files
- **codeCoverageUtils** - Utility functions for coverage calculations and data processing
- **codeCoverageHtmlReporter** - Generates HTML coverage reports
- **codeCoverageHtmlWriter** - Handles HTML content generation with customizable time units
- **codeCoverageAst** - AST-based source code analysis for line counting
- **exeLog** - Utility component to enable / disable execution logs 

### Usage

The extension components are automatically available once installed. Use them in your CFML code like:

```cfml
// Enable Execution Logging
codeCoverageReporter = new lucee.extension.lcov.exeLogger();
exeLogger.enableExecutionLog(
  class = "lucee.runtime.engine.ResourceExecutionLog",
  args = {
    "unit": "micro"
    , "min-time": 0
    , "directory": codeCoverageDir
  },
  maxlogs = 0
);

// Runs tests or whatever you like

// Disable Execution logging
exeLogger.disableExecutionLog(class="lucee.runtime.engine.ResourceExecutionLog");

// When running test suites, it's a good idea to exclude other code you aren't interested in reporting on
blocklist = [expandPath("/testbox"), expandPath("/specs"), expandPath("{lucee-config}")];
allowList = [];

// Create a coverage reporter instance
codeCoverageReporter = new lucee.extension.lcov.codeCoverageReporter();
// Generate reports from .exl files
generateCodeCoverage( coverageDir="/path/to/resourceExecutionlogs", outputFile="/path/to/LCOV.info",
			generateHtml=true, allowList=allowList, blocklist=blocklist, displayUnit="milli" )
```

[Examples](examples/coverage.cfm)

## Installation

Install the extension through the Lucee Administrator or deploy the .lex file manually.

## Requirements

- Lucee 7.0.0.372-SNAPSHOT or higher
- Java 11+

## License

GNU Lesser General Public License, Version 2.1

## Contributing

Contributions are welcome! Please submit issues and pull requests to the GitHub repository.
